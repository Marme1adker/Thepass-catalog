<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>The Pass â€” ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0f0d17; --surface:#1a1628; --surface2:#231d36; --border:#2e2648;
  --purple:#8b5cf6; --purple2:#a78bfa; --purple3:#6d28d9; --accent:#c4b5fd;
  --text:#e2dff0; --muted:#7c6fa0; --dim:#4a4268;
  --dlc:#f59e0b; --dlc-bg:#f59e0b18;
  --sidebar:260px;
}

.sidebar { z-index: 1001; }
.sidebar-overlay {
  z-index: 1000;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.4);
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;font-size:14px;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 80% 50% at 50% -10%,#3b1f6e22 0%,transparent 70%),radial-gradient(ellipse 40% 30% at 90% 80%,#5b21b611 0%,transparent 60%);pointer-events:none;z-index:0}

/* â•â•â•â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â•â•â•â• */
.page{position:relative;z-index:1;display:flex;min-height:100vh}

/* Ğ¡Ğ°Ğ¹Ğ´Ğ±Ğ°Ñ€ */
.sidebar{
  width:var(--sidebar);flex-shrink:0;
  background:var(--surface);
  border-right:1px solid var(--border);
  padding:20px 14px 40px;
  position:sticky;top:0;height:100vh;overflow-y:auto;
  display:flex;flex-direction:column;gap:4px;
}
.sidebar::-webkit-scrollbar{width:3px}
.sidebar::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

.sidebar-overlay{display:none;position:fixed;inset:0;background:#00000070;z-index:100}
.sidebar-overlay.open{display:block}

@media(max-width:700px){
  .sidebar{
    position:fixed;
    left:0;top:0;height:100vh;z-index:1001;
    transform:translateX(-100%);
    transition:transform .55s cubic-bezier(.32,1.25,.23,1),box-shadow .4s;
    box-shadow:0 0 0 transparent;
    background:rgba(26,22,40,0.75);
    backdrop-filter:blur(18px) saturate(160%);
    -webkit-backdrop-filter:blur(18px) saturate(160%);
  }
  .sidebar.open{
    transform:translateX(0);
    box-shadow:20px 0 60px rgba(0,0,0,.6);
  }
  .sidebar-overlay{
    display:block;position:fixed;inset:0;
    background:rgba(0,0,0,.45);
    backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
    opacity:0;visibility:hidden;
    transition:opacity .35s ease;z-index:1000;
  }
  .sidebar-overlay.open{opacity:1;visibility:visible;}
  body.drawer-open{overflow:hidden;}
}

.main{flex:1;min-width:0;padding:0 14px 80px}

/* â•â•â•â•â•â•â•â•â•â• Ğ¨ĞĞŸĞšĞ â•â•â•â•â•â•â•â•â•â• */
.header{padding:18px 0 14px;display:flex;align-items:center;gap:10px}
.header-logo{width:34px;height:34px;background:linear-gradient(135deg,var(--purple3),var(--purple2));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;box-shadow:0 0 14px #8b5cf640;flex-shrink:0}
.header-text h1{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;letter-spacing:-.3px}
.header-text p{font-size:11px;color:var(--muted);margin-top:1px}
.header-spacer{flex:1}

.filter-toggle-btn{
  display:none;align-items:center;gap:6px;
  background:var(--surface);border:1px solid var(--border);
  border-radius:10px;padding:7px 12px;
  color:var(--text);font-size:12px;font-weight:600;
  cursor:pointer;transition:border-color .15s,background .15s;
  white-space:nowrap;
}
.filter-toggle-btn:hover{border-color:var(--purple);background:var(--surface2)}
.filter-badge{background:var(--purple3);color:#fff;border-radius:10px;padding:1px 6px;font-size:10px;display:none}
.filter-badge.show{display:inline-block}
@media(max-width:700px){.filter-toggle-btn{display:flex}}

/* â•â•â•â•â•â•â•â•â•â• ĞŸĞĞ˜Ğ¡Ğš â•â•â•â•â•â•â•â•â•â• */
.search-wrap{position:relative;margin-bottom:12px}
.search-icon{position:absolute;left:11px;top:50%;transform:translateY(-50%);color:var(--dim);font-size:14px;pointer-events:none}
.search-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:11px;padding:10px 10px 10px 34px;color:var(--text);font-family:'Inter',sans-serif;font-size:13px;outline:none;transition:border-color .2s,box-shadow .2s}
.search-input::placeholder{color:var(--dim)}
.search-input:focus{border-color:var(--purple);box-shadow:0 0 0 3px #8b5cf618}
.search-clear{position:absolute;right:9px;top:50%;transform:translateY(-50%);background:var(--border);border:none;border-radius:50%;width:20px;height:20px;color:var(--muted);font-size:11px;cursor:pointer;display:none;align-items:center;justify-content:center}
.search-clear.visible{display:flex}

/* â•â•â•â•â•â•â•â•â•â• Ğ¢Ğ£Ğ›Ğ‘ĞĞ  â•â•â•â•â•â•â•â•â•â• */
.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;padding:0 1px}
.stats-count{font-size:11px;color:var(--muted)}
.stats-count span{color:var(--purple2);font-weight:600}
.view-toggle{display:flex;background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden}
.view-btn{background:none;border:none;padding:5px 9px;cursor:pointer;color:var(--dim);transition:background .15s,color .15s;display:flex;align-items:center;justify-content:center}
.view-btn.active{background:var(--purple3);color:#fff}

/* â•â•â•â•â•â•â•â•â•â• ĞĞšĞ¢Ğ˜Ğ’ĞĞ«Ğ• Ğ¢Ğ•Ğ“Ğ˜ â•â•â•â•â•â•â•â•â•â• */
.active-filters{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.af-chip{display:inline-flex;align-items:center;gap:5px;background:var(--purple3);border-radius:20px;padding:4px 10px 4px 10px;font-size:11px;color:#fff;cursor:pointer;transition:background .15s}
.af-chip:hover{background:#7c3aed}
.af-chip-x{font-size:13px;line-height:1;margin-left:1px}

/* â•â•â•â•â•â•â•â•â•â• SIDEBAR CONTROLS â•â•â•â•â•â•â•â•â•â• */
.sb-section{margin-bottom:6px}
.sb-section-hdr{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 6px 6px;cursor:pointer;
  font-family:'Syne',sans-serif;font-size:12px;font-weight:700;
  letter-spacing:.5px;color:var(--text);
  border-radius:8px;transition:background .15s;
  user-select:none;
}
.sb-section-hdr:hover{background:var(--surface2)}
.sb-chevron{font-size:11px;color:var(--muted);transition:transform .2s}
.sb-section.collapsed .sb-chevron{transform:rotate(-90deg)}
.sb-section.collapsed .sb-body{display:none}
.sb-body{padding:2px 0 6px}

.tag-btn{
  display:flex;align-items:center;gap:8px;width:100%;
  background:none;border:none;padding:6px 8px;border-radius:8px;
  color:var(--muted);font-family:'Inter',sans-serif;font-size:12px;
  cursor:pointer;transition:background .15s,color .15s;text-align:left;
}
.tag-btn:hover{background:var(--surface2);color:var(--text)}
.tag-btn.active{background:var(--purple3);color:#fff}
.tag-btn.active .tag-ico{opacity:1}
.tag-ico{font-size:14px;flex-shrink:0;opacity:.6}
.tag-count{margin-left:auto;font-size:10px;background:var(--surface2);border-radius:10px;padding:1px 6px;color:var(--dim)}
.tag-btn.active .tag-count{background:#ffffff20;color:#ffffffaa}

.sb-sep{height:1px;background:var(--border);margin:8px 4px}

.sb-reset{
  width:100%;background:none;border:1px solid var(--border);
  border-radius:10px;padding:8px;
  color:var(--muted);font-size:11px;font-family:'Inter',sans-serif;
  cursor:pointer;transition:all .15s;margin-top:8px;
}
.sb-reset:hover{border-color:var(--purple);color:var(--text);background:var(--surface2)}

/* â•â•â•â•â•â•â•â•â•â• Ğ“Ğ Ğ£ĞŸĞŸĞ / Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš â•â•â•â•â•â•â•â•â•â• */
.pub-header{display:flex;align-items:center;gap:8px;padding:10px 0 5px}
.pub-dot{width:5px;height:5px;border-radius:50%;background:var(--purple);box-shadow:0 0 5px var(--purple);flex-shrink:0}
.pub-name{font-family:'Syne',sans-serif;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted)}
.pub-line{flex:1;height:1px;background:linear-gradient(to right,var(--border),transparent)}

.dlc-tag{display:inline-flex;align-items:center;background:var(--dlc-bg);border:1px solid var(--dlc);border-radius:4px;padding:1px 5px;font-size:9px;font-weight:700;color:var(--dlc);letter-spacing:.5px;text-transform:uppercase;flex-shrink:0;margin-left:5px}

/* â•â•â•â•â•â•â•â•â•â• Ğ¡ĞŸĞ˜Ğ¡ĞĞš â•â•â•â•â•â•â•â•â•â• */
.list-card{display:flex;align-items:center;gap:11px;padding:9px 11px;background:var(--surface);border:1px solid var(--border);border-radius:11px;margin-bottom:5px;cursor:pointer;transition:background .15s,border-color .15s,transform .1s;-webkit-user-select:none;user-select:none;position:relative;overflow:hidden}
.list-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:linear-gradient(to bottom,var(--purple3),var(--purple2));opacity:0;transition:opacity .15s;border-radius:3px 0 0 3px}
.list-card:active{transform:scale(0.985);background:var(--surface2)}
.list-card:hover{border-color:var(--purple3);background:var(--surface2)}
.list-card:hover::before{opacity:1}
.list-icon{width:40px;height:40px;border-radius:9px;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;overflow:hidden}
.list-icon img{width:100%;height:100%;object-fit:cover;border-radius:8px}
.list-info{flex:1;min-width:0}
.list-row{display:flex;align-items:center;min-width:0;overflow:hidden}
.list-title{font-family:'Syne',sans-serif;font-size:12px;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.3}
.list-title mark{background:#8b5cf640;color:var(--accent);border-radius:3px;padding:0 1px}
.list-sub{font-size:10px;color:var(--muted);margin-top:2px}
.list-tags{display:flex;flex-wrap:wrap;gap:3px;margin-top:3px}
.list-tag{font-size:9px;background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:1px 5px;color:var(--dim)}
.list-arrow{color:var(--dim);font-size:15px;flex-shrink:0;margin-left:6px;transition:color .15s,transform .15s}
.list-card:hover .list-arrow{color:var(--purple2);transform:translateX(2px)}

/* â•â•â•â•â•â•â•â•â•â• Ğ¡Ğ•Ğ¢ĞšĞ â•â•â•â•â•â•â•â•â•â• */
.grid-wrap{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:4px}
@media(min-width:600px){.grid-wrap{grid-template-columns:repeat(3,1fr)}}
@media(min-width:900px){.grid-wrap{grid-template-columns:repeat(4,1fr)}}
@media(min-width:1200px){.grid-wrap{grid-template-columns:repeat(5,1fr)}}
.grid-pub-hdr{grid-column:1/-1;display:flex;align-items:center;gap:8px;padding:8px 0 2px}
.grid-card{background:var(--surface);border:1px solid var(--border);border-radius:11px;overflow:hidden;cursor:pointer;transition:transform .15s,border-color .15s;-webkit-user-select:none;user-select:none;position:relative}
.grid-card:active{transform:scale(0.96)}
.grid-card:hover{border-color:var(--purple3)}
.grid-card.is-dlc{border-color:#f59e0b28}
.grid-img{width:100%;aspect-ratio:16/9;background:var(--surface2);position:relative;overflow:hidden}
.grid-img img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .3s}
.grid-card:hover .grid-img img{transform:scale(1.04)}
.grid-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:28px;background:linear-gradient(135deg,var(--surface2),var(--border))}
.grid-badge{position:absolute;bottom:5px;left:5px;background:#00000085;backdrop-filter:blur(4px);border-radius:4px;padding:2px 5px;font-size:9px;color:var(--accent);font-weight:600;letter-spacing:.5px;text-transform:uppercase;border:1px solid #ffffff0f;max-width:calc(100% - 10px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.grid-dlc-badge{position:absolute;top:5px;right:5px;background:#f59e0bcc;border-radius:4px;padding:2px 5px;font-size:8px;font-weight:800;color:#000;letter-spacing:.5px}
.grid-info{padding:7px 9px 9px}
.grid-title{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;color:var(--text);line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.grid-title mark{background:#8b5cf640;color:var(--accent);border-radius:3px;padding:0 1px}
.grid-pub{font-size:9px;color:var(--muted);margin-top:2px}
.grid-tags{display:flex;flex-wrap:wrap;gap:2px;margin-top:4px}
.grid-tag{font-size:8px;background:var(--surface2);border:1px solid var(--border);border-radius:3px;padding:1px 4px;color:var(--dim)}

/* â•â•â•â•â•â•â•â•â•â• ĞŸĞ£Ğ¡Ğ¢Ğ â•â•â•â•â•â•â•â•â•â• */
.empty{text-align:center;padding:50px 20px;display:none}
.empty.visible{display:block}
.empty-icon{font-size:38px;margin-bottom:12px;opacity:.5}
.empty-text{font-family:'Syne',sans-serif;font-size:15px;color:var(--muted)}
.empty-sub{font-size:12px;color:var(--dim);margin-top:6px}

/* â•â•â•â•â•â•â•â•â•â• Ğ¢ĞĞ¡Ğ¢ â•â•â•â•â•â•â•â•â•â• */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--purple3);border-radius:12px;padding:10px 18px;font-size:13px;color:var(--accent);z-index:999;transition:transform .3s cubic-bezier(.34,1.56,.64,1);white-space:nowrap;box-shadow:0 8px 32px #00000060}
.toast.show{transform:translateX(-50%) translateY(0)}

/* â•â•â•â•â•â•â•â•â•â• Ğ›ĞĞĞ”Ğ•Ğ  â•â•â•â•â•â•â•â•â•â• */
.loader{text-align:center;padding:60px 20px}
.loader-spinner{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--purple);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 12px}
@keyframes spin{to{transform:rotate(360deg)}}
.loader-text{font-size:12px;color:var(--muted)}

/* â•â•â•â•â•â•â•â•â•â• ĞœĞĞ”ĞĞ›Ğ¬ĞĞĞ• ĞĞšĞĞ ĞŸĞĞ”Ğ¢Ğ’Ğ•Ğ Ğ–Ğ”Ğ•ĞĞ˜Ğ¯ â•â•â•â•â•â•â•â•â•â• */
.modal-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
  z-index:2000;
  display:flex;align-items:center;justify-content:center;
  padding:20px;
  opacity:0;visibility:hidden;
  transition:opacity .25s ease, visibility .25s ease;
}
.modal-overlay.open{
  opacity:1;visibility:visible;
}
.modal{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:20px;
  width:100%;max-width:380px;
  overflow:hidden;
  transform:scale(0.92) translateY(16px);
  transition:transform .3s cubic-bezier(.34,1.56,.64,1);
  box-shadow:0 24px 64px rgba(0,0,0,.6), 0 0 0 1px #8b5cf615;
}
.modal-overlay.open .modal{
  transform:scale(1) translateY(0);
}
.modal-img{
  width:100%;aspect-ratio:16/9;background:var(--surface2);
  position:relative;overflow:hidden;
}
.modal-img img{
  width:100%;height:100%;object-fit:cover;display:block;
}
.modal-img-placeholder{
  width:100%;height:100%;display:flex;align-items:center;
  justify-content:center;font-size:48px;
  background:linear-gradient(135deg,var(--surface2),var(--border));
}
.modal-img-overlay{
  position:absolute;inset:0;
  background:linear-gradient(to top, var(--surface) 0%, transparent 60%);
}
.modal-body{padding:16px 20px 20px}
.modal-label{
  font-size:10px;font-weight:700;letter-spacing:1.5px;
  text-transform:uppercase;color:var(--muted);margin-bottom:6px;
}
.modal-title{
  font-family:'Syne',sans-serif;font-size:18px;font-weight:800;
  color:var(--text);line-height:1.2;margin-bottom:4px;
}
.modal-meta{
  font-size:11px;color:var(--muted);margin-bottom:6px;
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
}
.modal-tags{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:16px}
.modal-tag{
  font-size:10px;background:var(--surface2);border:1px solid var(--border);
  border-radius:5px;padding:2px 7px;color:var(--dim);
}
.modal-dlc{
  display:inline-flex;align-items:center;
  background:var(--dlc-bg);border:1px solid var(--dlc);
  border-radius:5px;padding:2px 7px;font-size:10px;
  font-weight:700;color:var(--dlc);letter-spacing:.5px;
}
.modal-actions{display:flex;gap:8px}
.modal-btn{
  flex:1;border:none;border-radius:12px;
  padding:12px 16px;font-family:'Syne',sans-serif;
  font-size:13px;font-weight:700;cursor:pointer;
  transition:transform .1s, background .15s;
}
.modal-btn:active{transform:scale(0.97)}
.modal-btn-cancel{
  background:var(--surface2);color:var(--muted);
  border:1px solid var(--border);
}
.modal-btn-cancel:hover{background:var(--border);color:var(--text)}
.modal-btn-confirm{
  background:linear-gradient(135deg,var(--purple3),var(--purple2));
  color:#fff;
  box-shadow:0 4px 16px #8b5cf640;
}
.modal-btn-confirm:hover{box-shadow:0 6px 24px #8b5cf660}

#tagSearch:focus{border-color:var(--purple)!important;box-shadow:0 0 0 2px #8b5cf618}
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
</style>
</head>
<body>

<!-- Overlay Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ´Ñ€Ğ¾Ğ²ĞµÑ€Ğ° -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- â•â•â•â•â•â•â•â•â•â• ĞœĞĞ”ĞĞ›Ğ¬ĞĞĞ• ĞĞšĞĞ ĞŸĞĞ”Ğ¢Ğ’Ğ•Ğ Ğ–Ğ”Ğ•ĞĞ˜Ğ¯ â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal" id="modal">
    <div class="modal-img">
      <img id="modalImg" src="" alt="">
      <div class="modal-img-overlay"></div>
    </div>
    <div class="modal-body">
      <div class="modal-label">ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¸Ğ³Ñ€Ñ‹?</div>
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-meta" id="modalMeta"></div>
      <div class="modal-tags" id="modalTags"></div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel" id="modalCancel">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
        <button class="modal-btn modal-btn-confirm" id="modalConfirm">ğŸ” ĞĞ°Ğ¹Ñ‚Ğ¸</button>
      </div>
    </div>
  </div>
</div>

<div class="page">

  <!-- â•â•â•â•â•â• Ğ¡ĞĞ™Ğ”Ğ‘ĞĞ  Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ ĞĞ’ â•â•â•â•â•â• -->
  <aside class="sidebar" id="sidebar">

    <div class="sb-section" id="sec-name">
      <div class="sb-section-hdr" data-sec="sec-name">
        <span>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</span>
        <span class="sb-chevron">â–¾</span>
      </div>
      <div class="sb-body">
        <div class="search-wrap" style="margin-bottom:0">
          <span class="search-icon">ğŸ”</span>
          <input class="search-input" id="search" type="text" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ..." autocomplete="off" autocorrect="off" spellcheck="false" style="font-size:12px;padding:8px 8px 8px 30px">
          <button class="search-clear" id="clearBtn" style="width:18px;height:18px;font-size:10px">âœ•</button>
        </div>
      </div>
    </div>

    <div class="sb-sep"></div>

    <div class="sb-section" id="sec-studio">
      <div class="sb-section-hdr" data-sec="sec-studio">
        <span>Ğ¡Ñ‚ÑƒĞ´Ğ¸Ñ</span>
        <span class="sb-chevron">â–¾</span>
      </div>
      <div class="sb-body" id="studio-list"></div>
    </div>

    <div class="sb-sep"></div>

    <div class="sb-section" id="sec-genre">
      <div class="sb-section-hdr" data-sec="sec-genre">
        <span>Ğ–Ğ°Ğ½Ñ€</span>
        <span class="sb-chevron">â–¾</span>
      </div>
      <div class="sb-body" id="genre-list"></div>
    </div>

    <div class="sb-sep"></div>

    <div class="sb-section" id="sec-tags">
      <div class="sb-section-hdr" data-sec="sec-tags">
        <span>Ğ¢ĞµĞ³Ğ¸</span>
        <span class="sb-chevron">â–¾</span>
      </div>
      <div class="sb-body">
        <div style="position:relative;margin-bottom:4px">
          <span style="position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--dim);font-size:12px;pointer-events:none">ğŸ”</span>
          <input id="tagSearch" type="text" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ñ‚ĞµĞ³Ğ¾Ğ²..." autocomplete="off" spellcheck="false"
            style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:7px 7px 7px 28px;color:var(--text);font-family:'Inter',sans-serif;font-size:11px;outline:none;transition:border-color .2s">
        </div>
        <div id="tag-list"></div>
      </div>
    </div>

    <div class="sb-sep"></div>

    <div class="sb-section" id="sec-opts">
      <div class="sb-section-hdr" data-sec="sec-opts">
        <span>ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹</span>
        <span class="sb-chevron">â–¾</span>
      </div>
      <div class="sb-body">
        <button class="tag-btn" id="opt-dlc" data-opt="dlc">
          <span class="tag-ico">ğŸ”–</span>Ğ¡ DLC
        </button>
        <button class="tag-btn" id="opt-ru" data-opt="ru">
          <span class="tag-ico">ğŸ‡·ğŸ‡º</span>Ğ ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº
        </button>
        <button class="tag-btn" id="opt-online" data-opt="online">
          <span class="tag-ico">ğŸŒ</span>Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½
        </button>
      </div>
    </div>

    <button class="sb-reset" id="resetBtn">âœ• Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹</button>
  </aside>

  <!-- â•â•â•â•â•â• ĞĞ¡ĞĞĞ’ĞĞĞ™ ĞšĞĞĞ¢Ğ•ĞĞ¢ â•â•â•â•â•â• -->
  <div class="main">
    <div class="header">
      <div class="header-logo">ğŸ®</div>
      <div class="header-text"><h1>The Pass</h1><p>ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ğ¸Ğ³Ñ€</p></div>
      <div class="header-spacer"></div>
      <button class="filter-toggle-btn" id="filterToggleBtn">
        <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor"><path d="M1 3h14v1.5L9 10v5l-2-1V10L1 4.5V3z"/></svg>
        Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
        <span class="filter-badge" id="filterBadge">0</span>
      </button>
    </div>

    <div class="active-filters" id="activeFilters"></div>

    <div class="toolbar">
      <div class="stats-count">ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾: <span id="countNum">0</span></div>
      <div class="view-toggle">
        <button class="view-btn active" id="btnList" title="Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº">
          <svg width="15" height="15" viewBox="0 0 16 16" fill="currentColor"><rect x="0" y="1.5" width="16" height="2.8" rx="1.2"/><rect x="0" y="6.5" width="16" height="2.8" rx="1.2"/><rect x="0" y="11.5" width="16" height="2.8" rx="1.2"/></svg>
        </button>
        <button class="view-btn" id="btnGrid" title="ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸">
          <svg width="15" height="15" viewBox="0 0 16 16" fill="currentColor"><rect x="0" y="0" width="7" height="7" rx="1.5"/><rect x="9" y="0" width="7" height="7" rx="1.5"/><rect x="0" y="9" width="7" height="7" rx="1.5"/><rect x="9" y="9" width="7" height="7" rx="1.5"/></svg>
        </button>
      </div>
    </div>

    <div id="list"></div>
    <div class="empty" id="empty">
      <div class="empty-icon">ğŸ”</div>
      <div class="empty-text">Ğ˜Ğ³Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°</div>
      <div class="empty-sub">ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ</div>
    </div>
  </div>

</div>
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ’Ğ¡ĞŸĞĞœĞĞ“ĞĞ¢Ğ•Ğ›Ğ¬ĞĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯ Ğ”Ğ›Ğ¯ STEAM CDN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = id => `https://cdn.cloudflare.steamstatic.com/steam/apps/${id}/header.jpg`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ Ğ”ĞĞĞĞ«Ğ¥
// Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ fetchGames() Ğ½Ğ° ÑĞ²Ğ¾Ğ¹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:
// Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ fetch('/api/games') Ğ¸Ğ»Ğ¸ Telegram.WebApp.sendData + Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ±Ğ¾Ñ‚Ğ°.
// Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°:
// { title, short, group, img, hasDlc?, tags?, opts? }
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchGames() {
  // â”€â”€â”€ Ğ—Ğ”Ğ•Ğ¡Ğ¬ Ğ’ĞĞ¨ Ğ˜Ğ¡Ğ¢ĞĞ§ĞĞ˜Ğš Ğ”ĞĞĞĞ«Ğ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: return await fetch('/api/games').then(r => r.json());
  //
  // ĞĞ¸Ğ¶Ğµ â€” Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ-Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºĞ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» ÑÑ€Ğ°Ğ·Ñƒ.
  // ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ API, ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚Ğµ Ğ²ĞµÑÑŒ Ğ±Ğ»Ğ¾Ğº return [...] Ğ½Ğ¸Ğ¶Ğµ.
  return [
    // â”€â”€â”€ Rockstar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Grand Theft Auto V",              short:"GTA V",          group:"Rockstar",         img:S(271590),  hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¨ÑƒÑ‚ĞµÑ€","Ğ­ĞºÑˆĞ½"],           opts:["dlc","online"]},
    {title:"Red Dead Redemption 2",           short:"RDR2",           group:"Rockstar",         img:S(1174180), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¡ÑĞ¶ĞµÑ‚","Ğ’ĞµÑÑ‚ĞµÑ€Ğ½"],        opts:["dlc"]},
    {title:"Red Dead Redemption",             short:"RDR",            group:"Rockstar",         img:S(2668510),               tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ’ĞµÑÑ‚ĞµÑ€Ğ½","Ğ¡ÑĞ¶ĞµÑ‚"],        opts:[]},
    {title:"Grand Theft Auto: San Andreas",   short:"GTA SA",         group:"Rockstar",         img:S(12120),                 tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ­ĞºÑˆĞ½"],                   opts:[]},
    {title:"Grand Theft Auto: Vice City",     short:"GTA Vice City",  group:"Rockstar",         img:S(12110),                 tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ­ĞºÑˆĞ½"],                   opts:[]},
    {title:"Grand Theft Auto III",            short:"GTA III",        group:"Rockstar",         img:S(12100),                 tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ­ĞºÑˆĞ½"],                   opts:[]},
    // â”€â”€â”€ CD Projekt Red â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Cyberpunk 2077",                  short:"Cyberpunk",      group:"CD Projekt Red",   img:S(1091500), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","RPG","Ğ¡ÑĞ¶ĞµÑ‚","Ğ­ĞºÑˆĞ½"],     opts:["dlc","ru"]},
    {title:"The Witcher 3: Wild Hunt",        short:"Witcher 3",      group:"CD Projekt Red",   img:S(292030),  hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","RPG","Ğ¡ÑĞ¶ĞµÑ‚","Ğ¤ÑĞ½Ñ‚ĞµĞ·Ğ¸"],  opts:["dlc","ru"]},
    // â”€â”€â”€ Ubisoft â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Assassin's Creed Shadows",        short:"AC Shadows",     group:"Ubisoft",          img:S(3159330), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¡Ñ‚ĞµĞ»Ñ","Ğ­ĞºÑˆĞ½"],           opts:["dlc"]},
    {title:"Assassin's Creed Mirage",         short:"AC Mirage",      group:"Ubisoft",          img:S(3035570), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¡Ñ‚ĞµĞ»Ñ","Ğ­ĞºÑˆĞ½"],           opts:["dlc"]},
    {title:"Assassin's Creed Valhalla",       short:"AC Valhalla",    group:"Ubisoft",          img:S(2208920), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","RPG","Ğ­ĞºÑˆĞ½"],             opts:["dlc"]},
    {title:"Assassin's Creed Odyssey",        short:"AC Odyssey",     group:"Ubisoft",          img:S(812140),  hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","RPG","Ğ­ĞºÑˆĞ½"],             opts:["dlc"]},
    {title:"Far Cry 6",                       short:"Far Cry 6",      group:"Ubisoft",          img:S(2369390), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¨ÑƒÑ‚ĞµÑ€","Ğ­ĞºÑˆĞ½"],           opts:["dlc"]},
    {title:"Far Cry 5",                       short:"Far Cry 5",      group:"Ubisoft",          img:S(552520),  hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¨ÑƒÑ‚ĞµÑ€","ĞšĞ¾Ğ¾Ğ¿"],           opts:["dlc","online"]},
    {title:"Watch Dogs 2",                    short:"Watch Dogs 2",   group:"Ubisoft",          img:S(447040),  hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¥Ğ°ĞºĞ¸Ğ½Ğ³","Ğ­ĞºÑˆĞ½"],          opts:["dlc"]},
    {title:"Watch Dogs: Legion",              short:"Watch Dogs Legion",group:"Ubisoft",        img:S(2239550), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¥Ğ°ĞºĞ¸Ğ½Ğ³","ĞšĞ¾Ğ¾Ğ¿"],          opts:["dlc","online"]},
    {title:"For Honor",                       short:"For Honor",      group:"Ubisoft",          img:S(304390),  hasDlc:true,  tags:["Ğ¤Ğ°Ğ¹Ñ‚Ğ¸Ğ½Ğ³","ĞšĞ¾Ğ¾Ğ¿"],                        opts:["dlc","online"]},
    // â”€â”€â”€ FromSoftware â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"ELDEN RING",                      short:"Elden Ring",     group:"FromSoftware",     img:S(1245620), hasDlc:true,  tags:["Souls-like","ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€"],   opts:["dlc"]},
    {title:"Dark Souls III",                  short:"DS3",            group:"FromSoftware",     img:S(374320),  hasDlc:true,  tags:["Souls-like","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€","Ğ­ĞºÑˆĞ½"],           opts:["dlc"]},
    {title:"Sekiro: Shadows Die Twice",       short:"Sekiro",         group:"FromSoftware",     img:S(814380),                tags:["Souls-like","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€","Ğ¡Ñ‚ĞµĞ»Ñ"],          opts:[]},
    {title:"Armored Core VI: Fires of Rubicon",short:"AC6",          group:"FromSoftware",     img:S(1888160), hasDlc:true,  tags:["Ğ Ğ¾Ğ±Ğ¾Ñ‚Ñ‹","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€","Ğ­ĞºÑˆĞ½"],               opts:["dlc"]},
    // â”€â”€â”€ PlayStation Studios â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Marvel's Spider-Man 2",           short:"Spider-Man 2",   group:"PlayStation",      img:S(2651280), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ­ĞºÑˆĞ½","Ğ¡ÑƒĞ¿ĞµÑ€Ğ³ĞµÑ€Ğ¾Ğ¹"],      opts:["dlc"]},
    {title:"God of War RagnarÃ¶k",             short:"GoW RagnarÃ¶k",   group:"PlayStation",      img:S(2322010), hasDlc:true,  tags:["Ğ­ĞºÑˆĞ½","Ğ¡ÑĞ¶ĞµÑ‚","ĞœĞ¸Ñ„Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ"],             opts:["dlc"]},
    {title:"Ghost of Tsushima DIRECTOR'S CUT",short:"Ghost of Tsushima",group:"PlayStation",   img:S(2215430), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¡Ğ°Ğ¼ÑƒÑ€Ğ°Ğ¹","Ğ¡Ñ‚ĞµĞ»Ñ"],        opts:["dlc"]},
    {title:"The Last of Us Part I",           short:"TLOU 1",         group:"PlayStation",      img:S(1888930),               tags:["Ğ¥Ğ¾Ñ€Ñ€Ğ¾Ñ€","Ğ¡ÑĞ¶ĞµÑ‚","Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ"],            opts:[]},
    {title:"The Last of Us Part II Remastered",short:"TLOU 2",        group:"PlayStation",      img:S(2531310), hasDlc:true,  tags:["Ğ¥Ğ¾Ñ€Ñ€Ğ¾Ñ€","Ğ¡ÑĞ¶ĞµÑ‚","Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ"],            opts:["dlc"]},
    {title:"Helldivers 2",                    short:"Helldivers 2",   group:"PlayStation",      img:S(553850),  hasDlc:true,  tags:["ĞšĞ¾Ğ¾Ğ¿","Ğ¨ÑƒÑ‚ĞµÑ€","ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ¿Ğ»ĞµĞµÑ€"],            opts:["dlc","online"]},
    {title:"Detroit: Become Human",           short:"Detroit",        group:"PlayStation",      img:S(1222140),               tags:["Ğ¡ÑĞ¶ĞµÑ‚","Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ ĞºĞ¸Ğ½Ğ¾","Ğ¤Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°"],opts:[]},
    {title:"Death Stranding Director's Cut",  short:"Death Stranding",group:"PlayStation",      img:S(1850570), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ¡ÑĞ¶ĞµÑ‚","ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ"],      opts:["dlc"]},
    {title:"God of War",                      short:"God of War 2018",group:"PlayStation",      img:S(1593500),               tags:["Ğ­ĞºÑˆĞ½","Ğ¡ÑĞ¶ĞµÑ‚","ĞœĞ¸Ñ„Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ"],             opts:[]},
    {title:"Days Gone",                       short:"Days Gone",      group:"PlayStation",      img:S(1259420),               tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","Ğ—Ğ¾Ğ¼Ğ±Ğ¸","Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ"],      opts:[]},
    // â”€â”€â”€ Gearbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Borderlands 3",                   short:"BL3",            group:"Gearbox",          img:S(397540),  hasDlc:true,  tags:["Ğ¨ÑƒÑ‚ĞµÑ€","RPG","ĞšĞ¾Ğ¾Ğ¿","Ğ®Ğ¼Ğ¾Ñ€"],             opts:["dlc","online"]},
    {title:"Borderlands 2",                   short:"BL2",            group:"Gearbox",          img:S(49520),   hasDlc:true,  tags:["Ğ¨ÑƒÑ‚ĞµÑ€","RPG","ĞšĞ¾Ğ¾Ğ¿","Ğ®Ğ¼Ğ¾Ñ€"],             opts:["dlc","online"]},
    // â”€â”€â”€ Bethesda â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Fallout 4",                       short:"FO4",            group:"Bethesda",         img:S(377160),  hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","RPG","ĞŸĞ¾ÑÑ‚Ğ°Ğ¿Ğ¾ĞºĞ°Ğ»Ğ¸Ğ¿ÑĞ¸Ñ"],  opts:["dlc","ru"]},
    {title:"Fallout: New Vegas",              short:"FNV",            group:"Bethesda",         img:S(22380),   hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","RPG","ĞŸĞ¾ÑÑ‚Ğ°Ğ¿Ğ¾ĞºĞ°Ğ»Ğ¸Ğ¿ÑĞ¸Ñ"],  opts:["dlc"]},
    {title:"Fallout 3",                       short:"FO3",            group:"Bethesda",         img:S(22300),   hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","RPG","ĞŸĞ¾ÑÑ‚Ğ°Ğ¿Ğ¾ĞºĞ°Ğ»Ğ¸Ğ¿ÑĞ¸Ñ"],  opts:["dlc"]},
    {title:"Fallout 76",                      short:"FO76",           group:"Bethesda",         img:S(1151340), hasDlc:true,  tags:["ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ğ¼Ğ¸Ñ€","ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ¿Ğ»ĞµĞµÑ€","ĞŸĞ¾ÑÑ‚Ğ°Ğ¿Ğ¾ĞºĞ°Ğ»Ğ¸Ğ¿ÑĞ¸Ñ"],opts:["dlc","online"]},
    // â”€â”€â”€ Ğ˜Ğ½Ğ´Ğ¸ â€¢ Roguelike â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Hades",                           short:"Hades",          group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Roguelike", img:S(1145360),               tags:["Roguelike","Ğ­ĞºÑˆĞ½","Ğ¡ÑĞ¶ĞµÑ‚"],              opts:[]},
    {title:"Hades II",                        short:"Hades II",       group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Roguelike", img:S(1145350),               tags:["Roguelike","Ğ­ĞºÑˆĞ½"],                      opts:[]},
    {title:"Dead Cells",                      short:"Dead Cells",     group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Roguelike", img:S(588650),  hasDlc:true,  tags:["Roguelike","ĞœĞµÑ‚Ñ€Ğ¾Ğ¸Ğ´Ğ²Ğ°Ğ½Ğ¸Ñ","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€"],     opts:["dlc"]},
    {title:"Balatro",                         short:"Balatro",        group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Roguelike", img:S(2379780),               tags:["Roguelike","ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ"],                 opts:[]},
    {title:"Slay the Spire",                  short:"StS",            group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Roguelike", img:S(646570),  hasDlc:true,  tags:["Roguelike","ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ"],                 opts:["dlc"]},
    // â”€â”€â”€ Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµÑ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Hollow Knight",                   short:"Hollow Knight",  group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµÑ€",img:S(367520),               tags:["ĞœĞµÑ‚Ñ€Ğ¾Ğ¸Ğ´Ğ²Ğ°Ğ½Ğ¸Ñ","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€","ĞÑ‚Ğ¼Ğ¾ÑÑ„ĞµÑ€Ğ°"],    opts:[]},
    {title:"Celeste",                         short:"Celeste",        group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµÑ€",img:S(504230),               tags:["ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµÑ€","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€","Ğ¡ÑĞ¶ĞµÑ‚"],          opts:[]},
    {title:"Cuphead",                         short:"Cuphead",        group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµÑ€",img:S(268910),  hasDlc:true,  tags:["ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµÑ€","Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€","ĞšĞ¾Ğ¾Ğ¿"],           opts:["dlc","online"]},
    // â”€â”€â”€ Ğ˜Ğ½Ğ´Ğ¸ â€¢ RPG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Stardew Valley",                  short:"Stardew",        group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ RPG",       img:S(413150),               tags:["Ğ¤Ğ°Ñ€Ğ¼Ğ¸Ğ½Ğ³","Ğ Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ÑÑÑ‰ĞµĞµ","ĞšĞ¾Ğ¾Ğ¿"],        opts:["online"]},
    {title:"Undertale",                       short:"Undertale",      group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ RPG",       img:S(391540),               tags:["RPG","Ğ¡ÑĞ¶ĞµÑ‚","ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ"],               opts:[]},
    {title:"Disco Elysium",                   short:"Disco Elysium",  group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ RPG",       img:S(632470),  hasDlc:true,  tags:["RPG","Ğ¡ÑĞ¶ĞµÑ‚","Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²"],                opts:["dlc","ru"]},
    {title:"Outer Wilds",                     short:"Outer Wilds",    group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ RPG",       img:S(753640),  hasDlc:true,  tags:["ĞŸÑ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ","Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ","Ğ¡ÑĞ¶ĞµÑ‚"],    opts:["dlc"]},
    // â”€â”€â”€ Ğ˜Ğ½Ğ´Ğ¸ â€¢ Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Terraria",                        short:"Terraria",       group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ", img:S(105600),               tags:["Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ","ĞšÑ€Ğ°Ñ„Ñ‚","ĞšĞ¾Ğ¾Ğ¿","ĞŸĞµÑĞ¾Ñ‡Ğ½Ğ¸Ñ†Ğ°"],  opts:["online"]},
    {title:"Subnautica",                      short:"Subnautica",     group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ", img:S(264710),               tags:["Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ","Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ","Ğ¥Ğ¾Ñ€Ñ€Ğ¾Ñ€"],     opts:[]},
    {title:"Valheim",                         short:"Valheim",        group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ", img:S(892970),  hasDlc:true,  tags:["Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ","ĞšÑ€Ğ°Ñ„Ñ‚","ĞšĞ¾Ğ¾Ğ¿","Ğ’Ğ¸ĞºĞ¸Ğ½Ğ³Ğ¸"],    opts:["dlc","online"]},
    {title:"Satisfactory",                    short:"Satisfactory",   group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ Ğ’Ñ‹Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ", img:S(526870),  hasDlc:true,  tags:["ĞšÑ€Ğ°Ñ„Ñ‚","Ğ¡Ñ‚Ñ€Ğ¾Ğ¸Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ¾","ĞšĞ¾Ğ¾Ğ¿"],          opts:["dlc","online"]},
    // â”€â”€â”€ Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞšĞ¾Ğ¾Ğ¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {title:"Deep Rock Galactic",              short:"DRG",            group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞšĞ¾Ğ¾Ğ¿",      img:S(548430),  hasDlc:true,  tags:["ĞšĞ¾Ğ¾Ğ¿","Ğ¨ÑƒÑ‚ĞµÑ€","ĞŸĞ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ"],             opts:["dlc","online"]},
    {title:"It Takes Two",                    short:"It Takes Two",   group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞšĞ¾Ğ¾Ğ¿",      img:S(1426210),              tags:["ĞšĞ¾Ğ¾Ğ¿","ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼ĞµÑ€","Ğ¡ÑĞ¶ĞµÑ‚"],             opts:["online"]},
    {title:"Among Us",                        short:"Among Us",       group:"Ğ˜Ğ½Ğ´Ğ¸ â€¢ ĞšĞ¾Ğ¾Ğ¿",      img:S(945360),               tags:["ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ¿Ğ»ĞµĞµÑ€","Ğ”Ğ»Ñ Ğ²ÑĞµÑ…","ĞšĞ°Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ"],   opts:["online"]},
  ];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ˜ Ğ›ĞĞ“Ğ˜ĞšĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let ALL = [];
let STUDIOS = [], GENRES = [], ALL_TAGS = [];

// â”€â”€ Telegram WebApp â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tg = window.Telegram?.WebApp;
if(tg){ tg.ready(); tg.expand(); tg.setHeaderColor('#0f0d17'); tg.setBackgroundColor('#0f0d17'); }
function sendToBot(name){
  if(tg) tg.sendData(name);
  else showToast('âœ… ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: ' + name);
}

// â”€â”€ DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const listEl        = document.getElementById('list');
const emptyEl       = document.getElementById('empty');
const countEl       = document.getElementById('countNum');
const searchEl      = document.getElementById('search');
const clearBtn      = document.getElementById('clearBtn');
const toastEl       = document.getElementById('toast');
const btnList       = document.getElementById('btnList');
const btnGrid       = document.getElementById('btnGrid');
const resetBtn      = document.getElementById('resetBtn');
const studioList    = document.getElementById('studio-list');
const genreList     = document.getElementById('genre-list');
const tagListEl     = document.getElementById('tag-list');
const activeFilters = document.getElementById('activeFilters');
const tagSearchEl   = document.getElementById('tagSearch');
const filterToggle  = document.getElementById('filterToggleBtn');
const filterBadge   = document.getElementById('filterBadge');
const sidebar       = document.getElementById('sidebar');
const overlay       = document.getElementById('sidebarOverlay');

// ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ°
const modalOverlay  = document.getElementById('modalOverlay');
const modalImg      = document.getElementById('modalImg');
const modalTitle    = document.getElementById('modalTitle');
const modalMeta     = document.getElementById('modalMeta');
const modalTags     = document.getElementById('modalTags');
const modalCancel   = document.getElementById('modalCancel');
const modalConfirm  = document.getElementById('modalConfirm');

let view = 'list', toastT = null;
let pendingGame = null; // Ğ¸Ğ³Ñ€Ğ°, Ğ¾Ğ¶Ğ¸Ğ´Ğ°ÑÑ‰Ğ°Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ

// Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²
const state = {
  query: '',
  studios: new Set(),
  genres:  new Set(),
  tags:    new Set(),
  opts:    new Set(),
};

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(m){ toastEl.textContent=m; toastEl.classList.add('show'); clearTimeout(toastT); toastT=setTimeout(()=>toastEl.classList.remove('show'),2200); }
function hl(t,q){ if(!q) return t; const e=q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); return t.replace(new RegExp(`(${e})`,'gi'),'<mark>$1</mark>'); }
function grpBy(arr){ const g={}; arr.forEach(x=>{ if(!g[x.group]) g[x.group]=[]; g[x.group].push(x); }); return g; }

// â”€â”€ ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(game) {
  pendingGame = game;

  // ĞšĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ°
  modalImg.src = game.img || '';
  modalImg.alt = game.title;
  modalImg.onerror = function(){ this.style.display='none'; this.parentNode.querySelector('.modal-img-placeholder').style.display='flex'; };
  modalImg.style.display = 'block';
  const ph = modalImg.parentNode.querySelector('.modal-img-placeholder');
  if(ph) ph.style.display = 'none';

  // Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº
  modalTitle.textContent = game.title;

  // ĞœĞµÑ‚Ğ°: ÑÑ‚ÑƒĞ´Ğ¸Ñ + DLC
  modalMeta.innerHTML = `<span>ğŸ“ ${game.group}</span>` + (game.hasDlc ? ' <span class="modal-dlc">DLC</span>' : '');

  // Ğ¢ĞµĞ³Ğ¸
  const tags = game.tags || [];
  modalTags.innerHTML = tags.map(t => `<span class="modal-tag">${t}</span>`).join('');

  // ĞĞ¿Ñ†Ğ¸Ğ¸ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½/Ñ€ÑƒÑ
  const opts = game.opts || [];
  const extra = [];
  if(opts.includes('ru'))     extra.push('<span class="modal-tag">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</span>');
  if(opts.includes('online')) extra.push('<span class="modal-tag">ğŸŒ ĞĞ½Ğ»Ğ°Ğ¹Ğ½</span>');
  if(extra.length) modalTags.innerHTML += extra.join('');

  modalOverlay.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  modalOverlay.classList.remove('open');
  document.body.style.overflow = '';
  pendingGame = null;
}

modalCancel.addEventListener('click', closeModal);
modalOverlay.addEventListener('click', e => {
  if(e.target === modalOverlay) closeModal();
});
document.addEventListener('keydown', e => {
  if(e.key === 'Escape') {
    if(modalOverlay.classList.contains('open')) closeModal();
    else closeDrawer();
  }
});
modalConfirm.addEventListener('click', () => {
  if(!pendingGame) return;
  sendToBot(pendingGame.title);
  closeModal();
});

// â”€â”€ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº ÑĞ°Ğ¹Ğ´Ğ±Ğ°Ñ€Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildSidebarButtons(){
  studioList.innerHTML = '';
  STUDIOS.forEach(s=>{
    const cnt = ALL.filter(g=>g.group===s).length;
    const btn = document.createElement('button');
    btn.className = 'tag-btn';
    btn.dataset.type = 'studio';
    btn.dataset.val  = s;
    btn.innerHTML = `<span class="tag-ico">ğŸ®</span>${s}<span class="tag-count">${cnt}</span>`;
    studioList.appendChild(btn);
  });

  genreList.innerHTML = '';
  GENRES.forEach(g=>{
    const cnt = ALL.filter(x=>x.group===g).length;
    const btn = document.createElement('button');
    btn.className = 'tag-btn';
    btn.dataset.type = 'genre';
    btn.dataset.val  = g;
    const label = g.replace('Ğ˜Ğ½Ğ´Ğ¸ â€¢ ','');
    btn.innerHTML = `<span class="tag-ico">ğŸ•¹ï¸</span>${label}<span class="tag-count">${cnt}</span>`;
    genreList.appendChild(btn);
  });

  tagListEl.innerHTML = '';
  ALL_TAGS.forEach(t=>{
    const cnt = ALL.filter(g=>(g.tags||[]).includes(t)).length;
    const btn = document.createElement('button');
    btn.className = 'tag-btn';
    btn.dataset.type = 'tag';
    btn.dataset.val  = t;
    btn.innerHTML = `<span class="tag-ico">ğŸ·ï¸</span>${t}<span class="tag-count">${cnt}</span>`;
    tagListEl.appendChild(btn);
  });
}

// â”€â”€ ĞœĞ°Ñ‚Ñ‡ Ğ¸Ğ³Ñ€Ñ‹ Ñ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function matchesState(g, s){
  if(s.query){
    const q = s.query;
    if(!g.title.toLowerCase().includes(q) &&
       !(g.short||'').toLowerCase().includes(q) &&
       !(g.group||'').toLowerCase().includes(q)) return false;
  }
  if(s.studios.size > 0 || s.genres.size > 0){
    const allGroups = new Set([...s.studios, ...s.genres]);
    if(!allGroups.has(g.group)) return false;
  }
  if(s.tags.size > 0){
    const gt = g.tags||[];
    for(const t of s.tags){ if(!gt.includes(t)) return false; }
  }
  if(s.opts.has('dlc') && !g.hasDlc) return false;
  if(s.opts.has('ru')  && !(g.opts||[]).includes('ru')) return false;
  if(s.opts.has('online') && !(g.opts||[]).includes('online')) return false;
  return true;
}

// â”€â”€ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ‡Ğ¸Ğ¿Ñ‹ Ğ½Ğ°Ğ´ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateActiveFilters(){
  activeFilters.innerHTML = '';
  const add = (label, removeFn) => {
    const chip = document.createElement('div');
    chip.className = 'af-chip';
    chip.innerHTML = `${label}<span class="af-chip-x">Ã—</span>`;
    chip.addEventListener('click', removeFn);
    activeFilters.appendChild(chip);
  };
  state.studios.forEach(v=> add(v,       ()=>{ state.studios.delete(v); syncAndRender(); }));
  state.genres.forEach(v=>  add(v.replace('Ğ˜Ğ½Ğ´Ğ¸ â€¢ ',''), ()=>{ state.genres.delete(v); syncAndRender(); }));
  state.tags.forEach(v=>    add('ğŸ· '+v,  ()=>{ state.tags.delete(v); syncAndRender(); }));
  if(state.opts.has('dlc'))    add('ğŸ”– DLC',       ()=>{ state.opts.delete('dlc'); syncAndRender(); });
  if(state.opts.has('ru'))     add('ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹',  ()=>{ state.opts.delete('ru'); syncAndRender(); });
  if(state.opts.has('online')) add('ğŸŒ ĞĞ½Ğ»Ğ°Ğ¹Ğ½',    ()=>{ state.opts.delete('online'); syncAndRender(); });

  const total = state.studios.size + state.genres.size + state.tags.size + state.opts.size;
  filterBadge.textContent = total;
  filterBadge.classList.toggle('show', total > 0);
}

// â”€â”€ ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº ÑĞ°Ğ¹Ğ´Ğ±Ğ°Ñ€Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncButtonStates(){
  document.querySelectorAll('.tag-btn[data-type]').forEach(btn=>{
    const {type, val} = btn.dataset;
    let active = false;
    if(type==='studio') active = state.studios.has(val);
    else if(type==='genre') active = state.genres.has(val);
    else if(type==='tag')   active = state.tags.has(val);
    btn.classList.toggle('active', active);
  });
  document.querySelectorAll('.tag-btn[data-opt]').forEach(btn=>{
    btn.classList.toggle('active', state.opts.has(btn.dataset.opt));
  });
}

function syncAndRender(){
  syncButtonStates();
  updateActiveFilters();
  render();
}

// â”€â”€ ĞšĞ»Ğ¸ĞºĞ¸ Ğ¿Ğ¾ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼ ÑĞ°Ğ¹Ğ´Ğ±Ğ°Ñ€Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('click', e=>{
  const btn = e.target.closest('.tag-btn[data-type]');
  if(btn){
    const {type, val} = btn.dataset;
    const setMap = {studio: state.studios, genre: state.genres, tag: state.tags};
    const s = setMap[type];
    if(s.has(val)) s.delete(val); else s.add(val);
    syncAndRender();
  }
  const optBtn = e.target.closest('.tag-btn[data-opt]');
  if(optBtn){
    const o = optBtn.dataset.opt;
    if(state.opts.has(o)) state.opts.delete(o); else state.opts.add(o);
    syncAndRender();
  }
  const hdr = e.target.closest('.sb-section-hdr');
  if(hdr) hdr.parentElement.classList.toggle('collapsed');
});

// â”€â”€ Ğ¡Ğ±Ñ€Ğ¾Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
resetBtn.addEventListener('click', ()=>{
  state.studios.clear(); state.genres.clear(); state.tags.clear(); state.opts.clear();
  state.query = ''; searchEl.value = ''; clearBtn.classList.remove('visible');
  syncAndRender();
});

// â”€â”€ Drawer (Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openDrawer(){
  sidebar.classList.add('open');
  overlay.classList.add('open');
  document.body.classList.add('drawer-open');
}
function closeDrawer(){
  sidebar.classList.remove('open');
  overlay.classList.remove('open');
  document.body.classList.remove('drawer-open');
}

filterToggle.addEventListener('click', openDrawer);
overlay.addEventListener('click', closeDrawer);

document.addEventListener('click', e=>{
  if(window.innerWidth > 700) return;
  if(e.target.closest('.tag-btn') || e.target.closest('.sb-reset')){
    setTimeout(closeDrawer,150);
  }
});

// â”€â”€ ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tagSearchEl.addEventListener('input', ()=>{
  const q = tagSearchEl.value.trim().toLowerCase();
  tagListEl.querySelectorAll('.tag-btn[data-type="tag"]').forEach(btn=>{
    btn.style.display = btn.dataset.val.toLowerCase().includes(q) ? '' : 'none';
  });
});
tagSearchEl.addEventListener('click', e => e.stopPropagation());

// â”€â”€ ĞŸĞ¾Ğ¸ÑĞº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
searchEl.addEventListener('input', ()=>{
  state.query = searchEl.value.trim().toLowerCase();
  clearBtn.classList.toggle('visible', searchEl.value.length > 0);
  render();
});
clearBtn.addEventListener('click', ()=>{
  searchEl.value=''; state.query=''; clearBtn.classList.remove('visible'); render();
});

// â”€â”€ Ğ’Ğ¸Ğ´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnList.addEventListener('click',()=>{ if(view==='list') return; view='list'; btnList.classList.add('active'); btnGrid.classList.remove('active'); render(); });
btnGrid.addEventListener('click',()=>{ if(view==='grid') return; view='grid'; btnGrid.classList.add('active'); btnList.classList.remove('active'); render(); });

// â”€â”€ Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pubHdr(name, extra=''){
  const d = document.createElement('div');
  d.className = 'pub-header'+(extra?' '+extra:'');
  d.innerHTML = `<div class="pub-dot"></div><div class="pub-name">${name}</div><div class="pub-line"></div>`;
  return d;
}

// â”€â”€ Ğ ĞµĞ½Ğ´ĞµÑ€ ÑĞ¿Ğ¸ÑĞ¾Ğº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderList(filtered, q){
  Object.entries(grpBy(filtered)).forEach(([grpName, games])=>{
    listEl.appendChild(pubHdr(grpName));
    games.forEach(g=>{
      const c = document.createElement('div');
      c.className = 'list-card';
      const dlc = g.hasDlc ? '<span class="dlc-tag">DLC</span>' : '';
      const tagsHtml = (g.tags||[]).length
        ? `<div class="list-tags">${(g.tags||[]).map(t=>`<span class="list-tag">${t}</span>`).join('')}</div>` : '';
      c.innerHTML = `
        <div class="list-icon"><img src="${g.img}" alt="" loading="lazy" onerror="this.style.display='none';this.parentNode.textContent='ğŸ®'"></div>
        <div class="list-info">
          <div class="list-row"><div class="list-title">${hl(g.title,q)}</div>${dlc}</div>
          <div class="list-sub">${g.short||''}</div>
          ${tagsHtml}
        </div>
        <div class="list-arrow">â€º</div>
      `;
      c.addEventListener('click', ()=> openModal(g));
      listEl.appendChild(c);
    });
  });
}

// â”€â”€ Ğ ĞµĞ½Ğ´ĞµÑ€ ÑĞµÑ‚ĞºĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderGrid(filtered, q){
  Object.entries(grpBy(filtered)).forEach(([grpName, games])=>{
    listEl.appendChild(pubHdr(grpName,'grid-pub-hdr'));
    const wrap = document.createElement('div');
    wrap.className = 'grid-wrap';
    games.forEach(g=>{
      const c = document.createElement('div');
      c.className = 'grid-card'+(g.hasDlc?' is-dlc':'');
      const tagsHtml = (g.tags||[]).slice(0,3).length
        ? `<div class="grid-tags">${(g.tags||[]).slice(0,3).map(t=>`<span class="grid-tag">${t}</span>`).join('')}</div>` : '';
      c.innerHTML = `
        <div class="grid-img">
          <img src="${g.img}" alt="${g.title}" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
          <div class="grid-placeholder" style="display:none">ğŸ®</div>
          <div class="grid-badge">${g.short||''}</div>
          ${g.hasDlc?'<div class="grid-dlc-badge">DLC</div>':''}
        </div>
        <div class="grid-info">
          <div class="grid-title">${hl(g.title,q)}</div>
          <div class="grid-pub">${grpName}</div>
          ${tagsHtml}
        </div>
      `;
      c.addEventListener('click', ()=> openModal(g));
      wrap.appendChild(c);
    });
    listEl.appendChild(wrap);
  });
}

// â”€â”€ Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ½Ğ´ĞµÑ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render(){
  const filtered = ALL.filter(g=>matchesState(g, state));
  countEl.textContent = filtered.length;
  listEl.innerHTML = '';
  if(!filtered.length){ emptyEl.classList.add('visible'); return; }
  emptyEl.classList.remove('visible');
  const q = state.query;
  if(view==='list') renderList(filtered,q);
  else renderGrid(filtered,q);
}

// â”€â”€ Swipe close (Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let startX = 0, currentX = 0, isDragging = false;

sidebar.addEventListener('touchstart', e=>{
  if(window.innerWidth > 700) return;
  startX = e.touches[0].clientX;
  isDragging = true;
});
sidebar.addEventListener('touchmove', e=>{
  if(!isDragging) return;
  currentX = e.touches[0].clientX;
  const diff = currentX - startX;
  if(diff < 0) sidebar.style.transform = `translateX(${diff}px)`;
});
sidebar.addEventListener('touchend', ()=>{
  if(!isDragging) return;
  isDragging = false;
  if(currentX - startX < -80) closeDrawer();
  sidebar.style.transform = '';
});

// â”€â”€ Ğ—Ğ°Ğ¿ÑƒÑĞº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async () => {
  // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ°Ğ´ĞµÑ€
  listEl.innerHTML = `<div class="loader"><div class="loader-spinner"></div><div class="loader-text">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°...</div></div>`;

  try {
    const games = await fetchGames();

    // Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ title
    const seen = new Set();
    ALL = games.filter(g => {
      if(!g.title || seen.has(g.title)) return false;
      seen.add(g.title);
      return true;
    });

    // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
    STUDIOS  = [...new Set(ALL.filter(g=>!g.group.startsWith('Ğ˜Ğ½Ğ´Ğ¸')).map(g=>g.group))];
    GENRES   = [...new Set(ALL.filter(g=>g.group.startsWith('Ğ˜Ğ½Ğ´Ğ¸')).map(g=>g.group))];
    ALL_TAGS = [...new Set(ALL.flatMap(g=>g.tags||[]))].sort();

    buildSidebarButtons();
    syncButtonStates();
    render();
  } catch(err) {
    listEl.innerHTML = `<div class="loader"><div class="empty-icon">âš ï¸</div><div class="loader-text">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</div></div>`;
    console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°:', err);
  }
})();
</script>
</body>
</html>
