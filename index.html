<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>The Pass ‚Äî –ö–∞—Ç–∞–ª–æ–≥</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ñ–ò–í–û–ô –§–û–ù ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <canvas id="bg-canvas"></canvas>

  <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –¥—Ä–æ–≤–µ—Ä–∞ -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FULL-PAGE –°–¢–†–ê–ù–ò–¶–ê –ò–ì–†–´ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="game-page" id="gamePage">

    <!-- –®–∞–ø–∫–∞ -->
    <div class="gp-topbar">
      <button class="game-back-btn" id="gameBackBtn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
        –ù–∞–∑–∞–¥
      </button>
      <div class="gp-topbar-title" id="gpTopbarTitle"></div>
      <button class="game-page-fav-btn" id="gamePageFavBtn">ü§ç</button>
    </div>

    <div class="gp-scroll">

      <!-- –û–±–ª–æ–∂–∫–∞ -->
      <div class="gp-hero">
        <img id="gamePageImg" src="" alt="" style="display:none">
        <div class="gp-hero-placeholder" id="gamePagePlaceholder">üéÆ</div>
        <div class="gp-hero-gradient"></div>
        <!-- –ë–µ–π–¥–∂–∏ –ø–æ–≤–µ—Ä—Ö –æ–±–ª–æ–∂–∫–∏ -->
        <div class="gp-hero-badges">
          <span class="game-page-source" id="gamePageSource"></span>
          <span class="game-page-new-badge" id="gamePageNewBadge" style="display:none">‚ú® –ù–æ–≤–∏–Ω–∫–∞</span>
        </div>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç: 2 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ —à–∏—Ä–æ–∫–æ–º, 1 –Ω–∞ —É–∑–∫–æ–º -->
      <div class="gp-content">

        <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –∏–Ω—Ñ–æ -->
        <div class="gp-left">
          <h1 class="game-page-title" id="gamePageTitle"></h1>

          <!-- –†–µ–π—Ç–∏–Ω–≥ Steam -->
          <div class="gp-rating-row" id="gamePageRating" style="display:none">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="#60a5fa"><circle cx="12" cy="12" r="10"/></svg>
            <span class="gpr-label">–û—Ü–µ–Ω–∫–∏ –∏–≥—Ä–æ–∫–æ–≤:</span>
            <span class="gpr-value" id="gamePageRatingValue"></span>
            <span class="gpr-count" id="gamePageRatingCount"></span>
          </div>

          <!-- –ú–µ—Ç–∞: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –∂–∞–Ω—Ä, –≥–æ–¥ -->
          <div class="gp-meta-rows" id="gamePageMeta"></div>

          <!-- –¢–µ–≥–∏ -->
          <div class="game-page-tags" id="gamePageTags"></div>
        </div>

        <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –∫–Ω–æ–ø–∫–∏ -->
        <div class="gp-right">
          <button class="gp-btn-main" id="gamePageFind">
            üîç –ù–∞–π—Ç–∏ –∏–≥—Ä—É
          </button>
          <button class="gp-btn-secondary" id="gamePageShare">
            üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
          </button>
        </div>

      </div>

      <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ -->
      <div class="gp-section" id="gpRecentSection" style="display:none">
        <div class="gp-section-hdr">
          <span class="gp-section-ico">üïê</span>
          <div>
            <div class="gp-section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ</div>
          </div>
        </div>
        <div class="gp-cards-row" id="gpRecentList"></div>
      </div>

      <!-- –ü–æ—Ö–æ–∂–∏–µ –∏–≥—Ä—ã -->
      <div class="gp-section" id="gpSimilarSection" style="display:none">
        <div class="gp-section-hdr">
          <span class="gp-section-ico">üéÆ</span>
          <div>
            <div class="gp-section-title">–ü–æ—Ö–æ–∂–∏–µ –∏–≥—Ä—ã</div>
            <div class="gp-section-sub" id="gpSimilarSub"></div>
          </div>
        </div>
        <div class="gp-cards-row" id="gpSimilarList"></div>
      </div>

      <div style="height:40px"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –û–°–ù–û–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="mainPage">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –°–ê–ô–î–ë–ê–† ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <aside class="sidebar" id="sidebar">

      <div class="sb-section" id="sec-name">
        <div class="sb-section-hdr"><span>–ù–∞–∑–≤–∞–Ω–∏–µ</span><span class="sb-chevron">‚ñæ</span></div>
        <div class="sb-body">
          <div class="search-wrap" style="margin-bottom:0">
            <span class="search-icon">üîç</span>
            <input class="search-input" id="search" type="text"
              placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Ç–µ–≥—É..."
              autocomplete="off" autocorrect="off" spellcheck="false"
              style="font-size:12px;padding:8px 8px 8px 30px">
            <button class="search-clear" id="clearBtn" style="width:18px;height:18px;font-size:10px">‚úï</button>
          </div>
        </div>
      </div>

      <div class="sb-sep"></div>

      <div class="sb-section collapsed" id="sec-studio">
        <div class="sb-section-hdr"><span>–°—Ç—É–¥–∏—è</span><span class="sb-chevron">‚ñæ</span></div>
        <div class="sb-body" id="studio-list"></div>
      </div>

      <div class="sb-sep"></div>

      <div class="sb-section collapsed" id="sec-genre">
        <div class="sb-section-hdr"><span>–ñ–∞–Ω—Ä</span><span class="sb-chevron">‚ñæ</span></div>
        <div class="sb-body" id="genre-list"></div>
      </div>

      <div class="sb-sep"></div>

      <div class="sb-section collapsed" id="sec-tags">
        <div class="sb-section-hdr"><span>–¢–µ–≥–∏</span><span class="sb-chevron">‚ñæ</span></div>
        <div class="sb-body">
          <div style="position:relative;margin-bottom:4px">
            <span style="position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--dim);font-size:12px;pointer-events:none">üîç</span>
            <input id="tagSearch" type="text" placeholder="–ü–æ–∏—Å–∫ —Ç–µ–≥–æ–≤..."
              autocomplete="off" spellcheck="false"
              style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:7px 7px 7px 28px;color:var(--text);font-family:'Inter',sans-serif;font-size:11px;outline:none;transition:border-color .2s">
          </div>
          <div id="tag-list"></div>
        </div>
      </div>

      <div class="sb-sep"></div>

      <div class="sb-section" id="sec-source">
        <div class="sb-section-hdr"><span>–ò—Å—Ç–æ—á–Ω–∏–∫</span><span class="sb-chevron">‚ñæ</span></div>
        <div class="sb-body">
          <button class="tag-btn" id="sourceLocal" data-source="local">
            <span class="tag-ico">‚ö°</span>–õ–æ–∫–∞–ª—å–Ω—ã–µ<span class="source-hint">–º–≥–Ω–æ–≤–µ–Ω–Ω–æ</span>
          </button>
          <button class="tag-btn" id="sourceSteam" data-source="steam">
            <span class="tag-ico">üîµ</span>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö<span class="source-hint">—á–µ—Ä–µ–∑ —Å–∞–π—Ç</span>
          </button>
          <button class="tag-btn" id="sourceMarme" data-source="marme1adker">
            <span class="tag-ico">‚ûï</span>Plus<span class="source-hint">+</span>
          </button>
        </div>
      </div>

      <div class="sb-sep"></div>

      <div class="sb-section" id="sec-opts">
        <div class="sb-section-hdr"><span>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</span><span class="sb-chevron">‚ñæ</span></div>
        <div class="sb-body">
          <button class="tag-btn" data-opt="dlc"><span class="tag-ico">üîñ</span>–° DLC</button>
          <button class="tag-btn" data-opt="ru"><span class="tag-ico">üá∑üá∫</span>–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</button>
          <button class="tag-btn" data-opt="online"><span class="tag-ico">üåê</span>–î–æ—Å—Ç—É–ø–µ–Ω –æ–Ω–ª–∞–π–Ω</button>
          <button class="tag-btn" data-opt="new"><span class="tag-ico">‚ú®</span>–ù–æ–≤–∏–Ω–∫–∏</button>
        </div>
      </div>

      <button class="sb-reset" id="resetBtn">‚úï –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>

      <div class="sb-footer">
        <button class="sb-done-btn" id="doneBtn">–ì–æ—Ç–æ–≤–æ</button>
      </div>

      <!-- ‚ïê‚ïê –§–£–¢–ï–† –°–ê–ô–î–ë–ê–†–ê ‚ïê‚ïê -->
      <div class="sb-nav-footer">
        <nav class="sb-nav-links">
          <a href="contacts.html" class="sb-nav-link">üì¨ –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
          <a href="privacy.html"  class="sb-nav-link">üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>
          <a href="offer.html"    class="sb-nav-link">üìÑ –ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞</a>
          <a href="faq.html"      class="sb-nav-link">‚ùì FAQ</a>
          <a href="reviews.html"  class="sb-nav-link">üí¨ –û—Ç–∑—ã–≤—ã</a>
        </nav>
        <div class="sb-nav-copy">¬© 2025 The Pass</div>
      </div>

    </aside>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="main">

      <div class="header">
        <div class="header-logo">üéÆ</div>
        <div class="header-text">
          <h1>The Pass</h1>
          <p>–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</p>
        </div>
        <div class="header-spacer"></div>
        <button class="theme-toggle-btn" id="themeBtn" title="–¢–µ–º–∞">üåô</button>
        <button class="random-btn"       id="randomBtn" title="–°–ª—É—á–∞–π–Ω–∞—è –∏–≥—Ä–∞">üé≤</button>
        <button class="stats-toggle-btn" id="statsBtn"  title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">üìä</button>
        <button class="filter-toggle-btn" id="filterToggleBtn">
          <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
            <path d="M1 3h14v1.5L9 10v5l-2-1V10L1 4.5V3z"/>
          </svg>
          –§–∏–ª—å—Ç—Ä—ã
          <span class="filter-badge" id="filterBadge">0</span>
        </button>
      </div>

      <div class="stats-panel" id="statsPanel"></div>
      <div class="active-filters" id="activeFilters"></div>

      <div class="fav-panel" id="favPanel">
        <div class="fav-hdr">
          <div class="fav-title">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ <span class="fav-count" id="favCount"></span></div>
          <button class="history-clear" id="favClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div class="fav-list" id="favList"></div>
      </div>

      <div class="history-panel" id="historyPanel">
        <div class="history-hdr">
          <div class="history-title">üïê –ù–µ–¥–∞–≤–Ω–æ –∏—Å–∫–∞–ª–∏</div>
          <button class="history-clear" id="historyClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div class="history-list" id="historyList"></div>
      </div>

      <div class="toolbar">
        <div class="stats-count">–ù–∞–π–¥–µ–Ω–æ: <span id="countNum">0</span></div>
        <div class="toolbar-right">
          <select class="sort-select" id="sortSelect">
            <option value="default">–ü–æ –≥—Ä—É–ø–ø–∞–º</option>
            <option value="az">–ê ‚Üí –Ø</option>
            <option value="za">–Ø ‚Üí –ê</option>
            <option value="recent">–ù–µ–¥–∞–≤–Ω–∏–µ</option>
            <option value="rating">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É ‚≠ê</option>
          </select>
          <div class="view-toggle">
            <button class="view-btn active" id="btnList" title="–°–ø–∏—Å–æ–∫">
              <svg width="15" height="15" viewBox="0 0 16 16" fill="currentColor">
                <rect x="0" y="1.5" width="16" height="2.8" rx="1.2"/>
                <rect x="0" y="6.5" width="16" height="2.8" rx="1.2"/>
                <rect x="0" y="11.5" width="16" height="2.8" rx="1.2"/>
              </svg>
            </button>
            <button class="view-btn" id="btnGrid" title="–ö–∞—Ä—Ç–æ—á–∫–∏">
              <svg width="15" height="15" viewBox="0 0 16 16" fill="currentColor">
                <rect x="0" y="0" width="7" height="7" rx="1.5"/>
                <rect x="9" y="0" width="7" height="7" rx="1.5"/>
                <rect x="0" y="9" width="7" height="7" rx="1.5"/>
                <rect x="9" y="9" width="7" height="7" rx="1.5"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="source-stats" id="sourceStats"></div>
      <div id="list"></div>

      <div class="empty" id="empty">
        <div class="empty-icon">üîç</div>
        <div class="empty-text">–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>
        <div class="empty-sub">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –∑–∞–ø—Ä–æ—Å</div>
      </div>

    </div>
  </div>

  <!-- –¢–æ—Å—Ç -->
  <div class="toast" id="toast"></div>

  <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à -->
  <div class="hotkey-hint" id="hotkeyHint">
    <kbd>/</kbd> –ø–æ–∏—Å–∫ ¬∑ <kbd>?</kbd> —Å—Ç–∞—Ç ¬∑ <kbd>R</kbd> —Å–ª—É—á–∞–π–Ω–∞—è ¬∑ <kbd>Esc</kbd> –∑–∞–∫—Ä—ã—Ç—å
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –°–ö–†–ò–ü–¢–´ –ü–†–û–ï–ö–¢–ê ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script src="data.js"></script>
  <script src="state.js"></script>
  <script src="history.js"></script>
  <script src="favorites.js"></script>
  <script src="stats.js"></script>
  <script src="sidebar.js"></script>
  <script src="render.js"></script>
  <script src="app.js"></script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—Å—Ç
  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    clearTimeout(t._timer);
    t._timer = setTimeout(() => t.classList.remove('show'), 2200);
  }

  // –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–≥—Ä—ã
  window.openGamePage = function(game) {
    const page = document.getElementById('gamePage');
    const main = document.getElementById('mainPage');
    const title = game.name || game.title || '';

    // –¢–∞–π—Ç–ª –≤ —Ç–æ–ø–±–∞—Ä–µ
    document.getElementById('gpTopbarTitle').textContent = title;

    // –û–±–ª–æ–∂–∫–∞
    const img = document.getElementById('gamePageImg');
    const ph  = document.getElementById('gamePagePlaceholder');
    const imgSrc = game.img || game.image || '';
    if (imgSrc) {
      img.src = imgSrc; img.style.display = '';
      ph.style.display = 'none';
      img.onerror = () => { img.style.display = 'none'; ph.style.display = ''; };
    } else {
      img.style.display = 'none'; ph.style.display = '';
    }

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    document.getElementById('gamePageTitle').textContent = title;

    // –ò—Å—Ç–æ—á–Ω–∏–∫
    const srcEl = document.getElementById('gamePageSource');
    const src = game.source || 'local';
    const srcLabels = { local:'‚ö° –õ–æ–∫–∞–ª—å–Ω–∞—è', steam:'üîµ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö', marme1adker:'‚ûï Plus' };
    srcEl.textContent = srcLabels[src] || srcLabels.local;
    srcEl.className = 'game-page-source ' + src;

    // –ù–æ–≤–∏–Ω–∫–∞
    document.getElementById('gamePageNewBadge').style.display = game.isNew ? '' : 'none';

    // Steam —Ä–µ–π—Ç–∏–Ω–≥
    const rBlock = document.getElementById('gamePageRating');
    if (game.steamRating) {
      rBlock.style.display = '';
      const rv = document.getElementById('gamePageRatingValue');
      rv.textContent = game.steamRating.label || '';
      document.getElementById('gamePageRatingCount').textContent =
        game.steamRating.count ? `(${(+game.steamRating.count).toLocaleString('ru')})` : '';
      const score = game.steamRating.score || 0;
      rv.style.color = score >= 80 ? '#34d399' : score >= 60 ? '#f59e0b' : '#f87171';
    } else {
      rBlock.style.display = 'none';
    }

    // –ú–µ—Ç–∞-—Å—Ç—Ä–æ–∫–∏: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –∂–∞–Ω—Ä, –≥–æ–¥
    const metaEl = document.getElementById('gamePageMeta');
    const metaRows = [
      game.studio || game.publisher ? { label: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', val: game.studio || game.publisher } : null,
      game.genre  ? { label: '–ñ–∞–Ω—Ä', val: game.genre } : null,
      game.year   ? { label: '–ì–æ–¥ —Ä–µ–ª–∏–∑–∞', val: game.year } : null,
      game.hasRu  ? { label: '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫', val: '–ü–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞' + (game.ruVoice ? ' + –æ–∑–≤—É—á–∫–∞' : '') } : null,
    ].filter(Boolean);
    metaEl.innerHTML = metaRows.map(r =>
      `<div class="gp-meta-row"><span class="gp-meta-label">${r.label}:</span><span class="gp-meta-val">${r.val}</span></div>`
    ).join('');

    // –¢–µ–≥–∏
    const tagsEl = document.getElementById('gamePageTags');
    const tagsList = (game.tags||[]).map(t => `<span class="gp-tag">${t}</span>`);
    if (game.hasDlc)  tagsList.push(`<span class="gp-tag dlc">üîñ DLC</span>`);
    if (game.online)  tagsList.push(`<span class="gp-tag online">üåê Online</span>`);
    tagsEl.innerHTML = tagsList.join('');

    // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
    const favBtn = document.getElementById('gamePageFavBtn');
    const updateFav = () => favBtn.textContent = (window.isFav&&window.isFav(game)) ? '‚ù§Ô∏è' : 'ü§ç';
    updateFav();
    favBtn.onclick = () => {
      if (window.toggleFav) window.toggleFav(game);
      updateFav(); spawnHeartBurst(favBtn);
    };

    // –ù–∞–π—Ç–∏
    document.getElementById('gamePageFind').onclick = () => {
      if (window.openGameSearch) window.openGameSearch(game);
      else if (game.searchUrl)   window.open(game.searchUrl, '_blank');
      else sendToBot(title, game);
    };

    // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
    document.getElementById('gamePageShare').onclick = () => {
      const url  = game.steamUrl || (game.appid ? `https://store.steampowered.com/app/${game.appid}` : '');
      const text = url ? `${title}\n${url}` : title;
      if (navigator.clipboard) navigator.clipboard.writeText(text).then(() => showToast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'));
      else {
        const ta = Object.assign(document.createElement('textarea'), {value: text});
        document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
        showToast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
      }
    };

    // ‚îÄ‚îÄ –ü–æ—Ö–æ–∂–∏–µ –∏–≥—Ä—ã (—Ç–æ—Ç –∂–µ –∂–∞–Ω—Ä –∏–ª–∏ —Ç–µ–≥–∏) ‚îÄ‚îÄ
    renderSimilarGames(game);

    // ‚îÄ‚îÄ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ ‚îÄ‚îÄ
    renderRecentGames(game);

    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    document.getElementById('gameBackBtn').onclick = closeGamePage;

    // –°–≤–∞–π–ø –≤–ª–µ–≤–æ ‚Äî –Ω–∞–∑–∞–¥
    let startX = 0, startY2 = 0;
    const scroll = document.querySelector('.gp-scroll');
    page.ontouchstart = e => { startX = e.touches[0].clientX; startY2 = e.touches[0].clientY; };
    page.ontouchend   = e => {
      const dx = startX - e.changedTouches[0].clientX;
      const dy = Math.abs(e.changedTouches[0].clientY - startY2);
      if (dx < -80 && dy < 60 && (scroll ? scroll.scrollTop < 10 : true)) closeGamePage();
    };

    // –û—Ç–∫—Ä—ã–≤–∞–µ–º
    main.classList.add('page-hidden');
    page.classList.add('open');
    document.querySelector('.gp-scroll').scrollTop = 0;
    if (window.addHistory) window.addHistory(game);
  };

  // ‚îÄ‚îÄ –ü–æ—Ö–æ–∂–∏–µ –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderSimilarGames(current) {
    const sec  = document.getElementById('gpSimilarSection');
    const list = document.getElementById('gpSimilarList');
    const sub  = document.getElementById('gpSimilarSub');
    if (!window.ALL || !window.ALL.length) { sec.style.display='none'; return; }

    const curTags  = new Set(current.tags || []);
    const curTitle = (current.name || current.title || '').toLowerCase();

    const scored = window.ALL
      .filter(g => (g.name||g.title||'').toLowerCase() !== curTitle)
      .map(g => {
        let score = 0;
        if (g.genre && g.genre === current.genre) score += 3;
        (g.tags||[]).forEach(t => { if (curTags.has(t)) score += 1; });
        if (g.group && g.group === current.group) score += 1;
        return { g, score };
      })
      .filter(x => x.score > 0)
      .sort((a,b) => b.score - a.score)
      .slice(0, 8)
      .map(x => x.g);

    if (!scored.length) { sec.style.display='none'; return; }

    sub.textContent = `${window.ALL.length} –∏–≥—Ä –≤ –∫–∞—Ç–∞–ª–æ–≥–µ`;
    list.innerHTML = scored.map(g => gpMiniCard(g)).join('');
    list.querySelectorAll('.gp-mini-card').forEach((el, i) => {
      el.addEventListener('click', () => openGamePage(scored[i]));
    });
    sec.style.display = '';
  }

  // ‚îÄ‚îÄ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderRecentGames(current) {
    const sec  = document.getElementById('gpRecentSection');
    const list = document.getElementById('gpRecentList');
    const curTitle = (current.name || current.title || '').toLowerCase();

    // –ë–µ—Ä—ë–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑ history.js (–º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ —Å—Ç—Ä–æ–∫)
    let history = [];
    try {
      const raw = JSON.parse(localStorage.getItem('pass_history') || '[]');
      history = raw.filter(h => {
        const t = typeof h === 'string' ? h : (h.name||h.title||'');
        return t.toLowerCase() !== curTitle;
      }).slice(0, 8);
    } catch(e) {}

    if (!history.length || !window.ALL) { sec.style.display='none'; return; }

    // –ú–∞—Ç—á–∏–º –∫ –∏–≥—Ä–∞–º –≤ ALL
    const games = history.map(h => {
      const t = (typeof h === 'string' ? h : (h.name||h.title||'')).toLowerCase();
      return window.ALL.find(g => (g.name||g.title||'').toLowerCase() === t);
    }).filter(Boolean).slice(0, 8);

    if (!games.length) { sec.style.display='none'; return; }

    list.innerHTML = games.map(g => gpMiniCard(g)).join('');
    list.querySelectorAll('.gp-mini-card').forEach((el, i) => {
      el.addEventListener('click', () => openGamePage(games[i]));
    });
    sec.style.display = '';
  }

  // ‚îÄ‚îÄ –ú–∏–Ω–∏-–∫–∞—Ä—Ç–æ—á–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function gpMiniCard(g) {
    const img = g.img || g.image || '';
    const title = g.name || g.title || '';
    return `
      <div class="gp-mini-card">
        <div class="gp-mini-img">
          ${img
            ? `<img src="${img}" alt="" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">`
            : ''}
          <div class="gp-mini-ph" style="${img?'display:none':''}">üéÆ</div>
        </div>
        <div class="gp-mini-title">${title}</div>
      </div>`;
  }

  window.closeGamePage = function() {
    document.getElementById('gamePage').classList.remove('open');
    document.getElementById('mainPage').classList.remove('page-hidden');
  };

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && document.getElementById('gamePage').classList.contains('open'))
      closeGamePage();
    if ((e.key === 'r' || e.key === 'R') && !e.ctrlKey && !e.metaKey &&
        document.activeElement.tagName !== 'INPUT')
      document.getElementById('randomBtn').click();
  });
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –¢–ï–ú–ê ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
  (function(){
    const btn  = document.getElementById('themeBtn');
    let light  = localStorage.getItem('pass-theme') === 'light';
    function apply() {
      document.documentElement.classList.toggle('light-theme', light);
      btn.textContent = light ? '‚òÄÔ∏è' : 'üåô';
    }
    apply();
    btn.addEventListener('click', () => { light = !light; localStorage.setItem('pass-theme', light?'light':'dark'); apply(); });
  })();
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –°–õ–£–ß–ê–ô–ù–ê–Ø –ò–ì–†–ê ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
  document.getElementById('randomBtn').addEventListener('click', () => {
    const cards = [...document.querySelectorAll('.list-card, .grid-card')];
    if (!cards.length) { showToast('üòÖ –ù–µ—Ç –∏–≥—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞'); return; }
    const card = cards[Math.floor(Math.random() * cards.length)];
    card.scrollIntoView({ behavior:'smooth', block:'center' });
    card.classList.add('random-highlight');
    setTimeout(() => card.classList.remove('random-highlight'), 1400);
    setTimeout(() => card.click(), 400);
  });
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ê–ù–ò–ú–ê–¶–ò–Ø –°–ï–†–î–ï–ß–ö–ê ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
  function spawnHeartBurst(btn) {
    const rect = btn.getBoundingClientRect();
    const cx = rect.left + rect.width/2, cy = rect.top + rect.height/2;
    const emojis = ['‚ù§Ô∏è','üíú','‚ú®','üíñ','‚≠ê'];
    for (let i = 0; i < 12; i++) {
      const el = document.createElement('div');
      const angle = (Math.PI*2/12)*i + Math.random()*0.3;
      const dist  = 30 + Math.random()*40;
      el.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      el.style.cssText = `position:fixed;left:${cx}px;top:${cy}px;pointer-events:none;z-index:99999;`+
        `font-size:${10+Math.random()*10}px;transform:translate(-50%,-50%);`+
        `--dx:${Math.cos(angle)*dist}px;--dy:${Math.sin(angle)*dist}px;`+
        `animation:heartFly .85s ease forwards;`;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 950);
    }
  }
  </script>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ì–õ–ê–í–ù–´–ô PARTICLE SYSTEM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
  (function(){
    const canvas = document.getElementById('bg-canvas');
    const ctx    = canvas.getContext('2d');
    let W, H;
    function resize(){ W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
    resize(); window.addEventListener('resize', resize);

    const PL = 'rgba(192,132,252,', PM = 'rgba(139,92,246,', WH = 'rgba(255,255,255,';
    const rnd  = (a,b) => Math.random()*(b-a)+a;
    const rndI = (a,b) => Math.floor(rnd(a,b));

    // –ú—ã—à—å/—Ç–∞—á –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    let mx = -999, my = -999;
    window.addEventListener('mousemove', e=>{ mx=e.clientX; my=e.clientY; });
    window.addEventListener('touchmove', e=>{ mx=e.touches[0].clientX; my=e.touches[0].clientY; },{passive:true});

    // –í–æ–ª–Ω–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    let scrollAmp = 0;
    window.addEventListener('scroll', ()=>{ scrollAmp = Math.min(scrollAmp+0.8, 1); },{passive:true});

    // 1. –¢–æ—á–∫–∏ (–±–æ–ª—å—à–µ)
    const DOTS = 200;
    const dots = Array.from({length:DOTS}, ()=>({
      x:rnd(0,1), y:rnd(0,1), r:rnd(0.4,2.2),
      a:rnd(0.15,0.75), sp:rnd(0.00008,0.00025), ph:rnd(0,Math.PI*2),
      col: Math.random()<0.6 ? WH : (Math.random()<0.5 ? PL : PM),
    }));

    function drawDots(t){
      dots.forEach(d=>{
        const base = d.a*(0.55+0.45*Math.sin(t*d.sp*1000+d.ph));
        const dx = d.x*W - mx, dy = d.y*H - my;
        const dist2 = dx*dx+dy*dy;
        const boost = dist2<80000 ? 1+(1-Math.sqrt(dist2)/283)*1.2 : 1;
        ctx.beginPath(); ctx.arc(d.x*W, d.y*H, d.r*boost, 0, Math.PI*2);
        ctx.fillStyle = d.col+Math.min(base*boost,1)+')'; ctx.fill();
      });
    }

    // 2. –ë–æ–ª—å—à–∏–µ –∑–≤—ë–∑–¥—ã (–±–æ–ª—å—à–µ)
    const GLOWS = 32;
    const glows = Array.from({length:GLOWS}, ()=>({
      x:rnd(0,1), y:rnd(0,1), r:rnd(1,3.8),
      a:rnd(0.4,0.95), sp:rnd(0.00005,0.00015), ph:rnd(0,Math.PI*2),
      vx:rnd(-0.000025,0.000025), vy:rnd(-0.000015,0.000015),
      col: Math.random()<0.55 ? WH : PL,
    }));

    function drawGlows(t){
      glows.forEach(g=>{
        g.x=(g.x+g.vx+1)%1; g.y=(g.y+g.vy+1)%1;
        const a=g.a*(0.5+0.5*Math.sin(t*g.sp*1000+g.ph));
        const cx=g.x*W, cy=g.y*H;
        const grad=ctx.createRadialGradient(cx,cy,0,cx,cy,g.r*5);
        grad.addColorStop(0, g.col+(a*0.6)+')');
        grad.addColorStop(0.4, g.col+(a*0.2)+')');
        grad.addColorStop(1, g.col+'0)');
        ctx.beginPath(); ctx.arc(cx,cy,g.r*5,0,Math.PI*2); ctx.fillStyle=grad; ctx.fill();
        ctx.beginPath(); ctx.arc(cx,cy,g.r,0,Math.PI*2); ctx.fillStyle=g.col+a+')'; ctx.fill();
      });
    }

    // 3. –°–∏–º–≤–æ–ª—ã (–±–æ–ª—å—à–µ + –Ω–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã)
    const SYMS = ['‚ô•','‚ú¶','‚úß','‚òÖ','‚óÜ','‚ú¶','‚ô•','‚úß','‚óá','‚ú∂'];
    const SPCOUNT = 18;
    const specials = Array.from({length:SPCOUNT}, ()=>mkSp());

    function mkSp(fromBottom=false){
      return {
        sym:SYMS[rndI(0,SYMS.length)], x:rnd(0.05,0.95),
        y:fromBottom?1.05:rnd(0.05,0.95),
        size:rnd(8,20), alpha:0, maxA:rnd(0.1,0.35),
        vx:rnd(-0.00005,0.00005), vy:rnd(-0.00015,-.00005),
        life:0, total:rnd(260,560),
        col: Math.random()<0.5 ? PL : (Math.random()<0.5 ? WH : PM),
      };
    }

    function drawSpecials(){
      specials.forEach((s,i)=>{
        s.life++; s.x=(s.x+s.vx+1)%1; s.y+=s.vy;
        const p=s.life/s.total;
        if(p<0.18) s.alpha=s.maxA*(p/0.18);
        else if(p<0.75) s.alpha=s.maxA;
        else s.alpha=s.maxA*(1-(p-0.75)/0.25);
        if(s.life>=s.total||s.y<-0.05){specials[i]=mkSp(true);return;}
        ctx.save(); ctx.globalAlpha=Math.max(0,s.alpha);
        ctx.font=s.size+'px serif'; ctx.fillStyle=s.col+s.alpha+')';
        ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.shadowBlur=12; ctx.shadowColor=s.col+'0.5)';
        ctx.fillText(s.sym, s.x*W, s.y*H);
        ctx.shadowBlur=0; ctx.restore();
      });
    }

    // 4. –¶–≤–µ—Ç–æ–≤–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è —Ñ–æ–Ω–∞
    function drawPulse(t){
      const intensity = 0.055 + 0.04*Math.sin(t*0.25);
      const hue = 268 + 22*Math.sin(t*0.12);
      const gr = ctx.createRadialGradient(W/2,-H*0.1,0, W/2,-H*0.1, H*0.85);
      gr.addColorStop(0, `hsla(${hue},65%,48%,${intensity})`);
      gr.addColorStop(1, 'transparent');
      ctx.fillStyle=gr; ctx.fillRect(0,0,W,H);
    }

    // 5. –í–æ–ª–Ω–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    function drawScrollWave(t){
      if(scrollAmp<=0.01){scrollAmp=0;return;}
      scrollAmp*=0.96;
      for(let layer=0;layer<2;layer++){
        const yBase = H*(0.35+layer*0.2);
        const amp   = 35*scrollAmp*(1-layer*0.4);
        const spd   = 2+layer;
        ctx.beginPath(); ctx.moveTo(0,yBase);
        for(let x=0;x<=W;x+=3)
          ctx.lineTo(x, yBase+Math.sin(x/70+t*spd+layer)*amp);
        ctx.strokeStyle=`rgba(139,92,246,${0.1*scrollAmp*(1-layer*0.5)})`;
        ctx.lineWidth=1+layer*0.5; ctx.stroke();
      }
    }

    let spawnT=0;
    function maybeSpawn(){
      if(++spawnT>55&&Math.random()<0.022){
        spawnT=0; specials[rndI(0,specials.length)]=mkSp(true);
      }
    }

    let st=null;
    function frame(ts){
      if(!st)st=ts; const t=(ts-st)/1000;
      ctx.clearRect(0,0,W,H);
      drawPulse(t); drawDots(t); drawGlows(t);
      drawSpecials(); drawScrollWave(t); maybeSpawn();
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  })();
  </script>



</body>
</html>